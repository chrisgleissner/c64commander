# Smoke test for local playback flow
# Tests opening the native Android file picker and returning to playlist
# Note: The file picker behavior varies by Android version and emulator state

appId: uk.gleissner.c64commander
---
- runFlow: subflows/open-play-add-items.yaml
- scroll
- tapOn:
    text: "Add file / folder from device"
- takeScreenshot: "file-picker-open"

# Handle permission dialogs (optional - may not appear on all devices)
- tapOn:
    text: "Allow"
    optional: true
- tapOn:
    text: "Allow access"
    optional: true
- tapOn:
    text: "Allow all the time"
    optional: true

# Try to dismiss the file picker
- tapOn:
    text: "Cancel"
    optional: true
- tapOn:
    text: "Back"
    optional: true
- tapOn:
    text: "Navigate up"
    optional: true

# Press back multiple times to ensure we exit the picker
- back
- back
- back

# Re-launch the app to ensure clean state
- launchApp:
    clearState: false

# Wait for app to stabilize
- waitForAnimationToEnd

# Verify we're back in the app - use optional assertions for resilience
- extendedWaitUntil:
    visible: "C64 Commander"
    timeout: 10000
- extendedWaitUntil:
    visible: "Play"
    timeout: 10000

- takeScreenshot: "playlist-return"
