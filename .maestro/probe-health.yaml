# Minimal health probe flow
# This flow verifies the emulator and app are responsive before running other tests.
# It should complete in under 10 seconds.
# If this flow fails, the emulator/app state is not suitable for testing.

appId: uk.gleissner.c64commander
tags:
  - probe
env:
  SHORT_TIMEOUT: ${SHORT_TIMEOUT || "10000"}
  TIMEOUT: ${TIMEOUT || "30000"}
---
# Step 1: Launch app and handle demo mode if needed
- runFlow: subflows/launch-and-wait.yaml

# Step 2: Verify main UI is visible
- extendedWaitUntil:
    visible:
      id: "tab-home"
    timeout: ${SHORT_TIMEOUT}
- assertVisible: "Home"

# Step 3: Take a screenshot to prove UI is rendered
- takeScreenshot: probe-health-home

# Step 4: Verify navigation is responsive - tap a tab
- tapOn:
    id: "tab-play"

# Step 5: Verify navigation worked
- extendedWaitUntil:
    visible: "Play Files"
    timeout: ${TIMEOUT}

# Step 6: Return to home
- tapOn:
    id: "tab-home"

# Step 7: Final verification
- extendedWaitUntil:
    visible:
      id: "tab-home"
    timeout: ${SHORT_TIMEOUT}
- assertVisible: "Home"

- takeScreenshot: probe-health-complete
