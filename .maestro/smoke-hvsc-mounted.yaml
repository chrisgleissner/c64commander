# Smoke test for mounted HVSC-like library via Android file picker
# Requires /sdcard/Download/C64Music to exist (generated by smoke runner)

appId: uk.gleissner.c64commander
---
- runFlow: subflows/open-play-add-items.yaml
- scrollUntilVisible:
    element: "Add file / folder from device"
    direction: DOWN
    timeout: 15000
- tapOn:
    text: "Add file / folder from device"
- takeScreenshot: picker-open

# Handle permission dialogs (optional - may not appear on all devices)
- tapOn:
    text: "Allow"
    optional: true
- tapOn:
    text: "Allow access"
    optional: true
- tapOn:
    text: "Allow all the time"
    optional: true

- extendedWaitUntil:
    visible: "Show roots"
    timeout: 10000
- tapOn: "Show roots"
- extendedWaitUntil:
    visible: "Downloads"
    timeout: 10000
- tapOn: "Downloads"
- extendedWaitUntil:
    visible: "C64Music"
    timeout: 20000
- takeScreenshot: picker-downloads
- tapOn: "C64Music"
- takeScreenshot: picker-c64music
- extendedWaitUntil:
    visible: "Use this folder"
    timeout: 10000
- tapOn: "Use this folder"
- tapOn:
    text: "Allow"
    optional: true

# Back in app: wait for playlist to populate
- extendedWaitUntil:
    visible: "Play Files"
    timeout: 20000
- scrollUntilVisible:
    element: "35_Years.sid"
    direction: DOWN
    timeout: 60000
- takeScreenshot: playlist-populated

# Filter to SID-only
- tapOn: "MOD music"
- tapOn: "PRG program"
- tapOn: "CRT cartridge"
- tapOn: "Disk image"
- takeScreenshot: filter-sid-only

- scrollUntilVisible:
    element: "35_Years.sid"
    direction: DOWN
    timeout: 30000
- tapOn: "35_Years.sid"

# Assert playback is active
- extendedWaitUntil:
    visible: "Stop"
    timeout: 10000
- assertVisible: "35_Years.sid"
- assertNotVisible: "Playback failed"
- assertNotVisible: "No supported files"
- assertNotVisible: "Add items failed"
- takeScreenshot: now-playing
