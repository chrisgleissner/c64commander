appId: uk.gleissner.c64commander
tags:
  - edge
  - slow
env:
  SHORT_TIMEOUT: ${SHORT_TIMEOUT || "5000"}
  TIMEOUT: ${TIMEOUT || "15000"}
  LONG_TIMEOUT: ${LONG_TIMEOUT || "20000"}
---
- runFlow: subflows/open-play-add-items.yaml

# Add a known SID from the C64 Ultimate mock source.
- tapOn:
    id: "import-option-c64u"
- extendedWaitUntil:
    visible: "Select items"
    timeout: ${SHORT_TIMEOUT}
- extendedWaitUntil:
    visible: "Open Usb0"
    timeout: ${TIMEOUT}
- tapOn: "Open Usb0"

- extendedWaitUntil:
    visible: "Open Music"
    timeout: ${TIMEOUT}
- tapOn: "Open Music"

- extendedWaitUntil:
    visible: "Select Mock_Tune_0001.sid"
    timeout: ${TIMEOUT}

# Select the file and confirm.
- tapOn: "Select Mock_Tune_0001.sid"
- tapOn: "Add to playlist"

# Wait for playlist to show the new entry (header + item => 2 items).
- extendedWaitUntil:
    visible: "2 items"
    timeout: ${TIMEOUT}
- takeScreenshot: playlist-item-added

# Start playback via transport controls and verify it is active.
- tapOn:
    id: "playlist-play"
- extendedWaitUntil:
    visible: "Stop"
    timeout: ${SHORT_TIMEOUT}

# Stop playback before manipulating selections.
- tapOn:
    id: "playlist-play"
- extendedWaitUntil:
    visible: "Play"
    timeout: ${SHORT_TIMEOUT}

# Remove the playlist item via the header action.
- scrollUntilVisible:
    element: "Mock_Tune_0001.sid"
    direction: DOWN
    timeout: ${TIMEOUT}
- tapOn: "Clear playlist"
- extendedWaitUntil:
    visible: "No tracks in playlist yet."
    timeout: ${TIMEOUT}
- assertVisible: "No tracks in playlist yet."
- takeScreenshot: playlist-item-removed
