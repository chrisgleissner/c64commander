# Smoke test for file picker cancellation flow
# Tests opening the native Android file picker and cancelling
# Note: The file picker behavior varies by Android version and emulator state

appId: uk.gleissner.c64commander
tags:
  - device
  - ci-critical
env:
  SHORT_TIMEOUT: ${SHORT_TIMEOUT || "5000"}
  TIMEOUT: ${TIMEOUT || "15000"}
  LONG_TIMEOUT: ${LONG_TIMEOUT || "20000"}
---
- runFlow: subflows/open-play-add-items.yaml
- scrollUntilVisible:
    element:
      id: "import-option-local"
    direction: DOWN
    timeout: ${SHORT_TIMEOUT}
- tapOn:
    id: "import-option-local"
- takeScreenshot: file-picker-open

# Try to dismiss the file picker
- tapOn:
    text: "Cancel"
    optional: true
- tapOn:
    text: "Back"
    optional: true
- tapOn:
    text: "Navigate up"
    optional: true

# Press back multiple times to ensure we exit the picker
- repeat:
    times: 3
    commands:
      - back

# Relaunch and return to Home tab
- launchApp
- runFlow:
    when:
      visible: "Continue in Demo Mode"
    file: subflows/continue-demo.yaml
- tapOn:
    text: "Continue in Demo Mode"
    optional: true
- tapOn:
    text: "Got it"
    optional: true
- tapOn:
    text: "Wait"
    optional: true
- tapOn:
    text: "Close app"
    optional: true
- launchApp
- tapOn:
    point: "8%,95%"
    optional: true
- extendedWaitUntil:
    visible:
      text: "Home"
    timeout: ${LONG_TIMEOUT}

- takeScreenshot: picker-cancelled
